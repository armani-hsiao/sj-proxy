<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SJ 代購系統</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=Cinzel:wght@400;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- LOGIN -->
<div id="login-screen" class="screen active">
  <div class="login-wrap">
    <div class="login-crest">
      <div class="crest-ring">👑</div>
      <span class="login-title">SJ PROXY</span>
      <span class="login-sub">Super Junior 代購系統</span>
    </div>
    <span class="login-sect">選擇帳號</span>
    <div class="user-grid" style="grid-template-columns:1fr 1fr 1fr">
      <button class="user-btn" data-user="Armani" onclick="selectUser(this)">Armani</button>
      <button class="user-btn" data-user="9n" onclick="selectUser(this)">9n</button>
      <button class="user-btn" data-user="Cindy欣怡" onclick="selectUser(this)">Cindy欣怡</button>
      <button class="user-btn" data-user="Lilian Lin" onclick="selectUser(this)">Lilian Lin</button>
      <button class="user-btn" data-user="Lydia" onclick="selectUser(this)">Lydia</button>
      <button class="user-btn" data-user="mwah" onclick="selectUser(this)">mwah</button>
      <button class="user-btn" data-user="MɪA·͜·♡" onclick="selectUser(this)">MɪA·͜·♡</button>
      <button class="user-btn" data-user="shin" onclick="selectUser(this)">shin</button>
      <button class="user-btn" data-user="張惠婷Hui-Ting" onclick="selectUser(this)">張惠婷Hui-Ting</button>
      <button class="user-btn" data-user="張芷維維維" onclick="selectUser(this)">張芷維維維</button>
      <button class="user-btn" data-user="𝘽𝙖𝙣𝙙𝙖𝙣⋆☽" onclick="selectUser(this)">𝘽𝙖𝙣𝙙𝙖𝙣⋆☽</button>
      <button class="user-btn admin-btn" data-user="管理員" onclick="selectUser(this)" style="grid-column:1/-1">✦ 管理員</button>
    </div>
    <input type="password" id="login-password" class="fi" placeholder="輸入密碼" style="margin-bottom:6px" onkeydown="if(event.key==='Enter')doLogin()">
    <div id="pw-hint" style="font-size:11px;color:var(--text3);padding:0 2px;min-height:16px;transition:all .2s"></div>
    <button class="btn-login" id="login-btn" disabled onclick="doLogin()">進入系統</button>
  </div>
</div>

<!-- APP -->
<div id="app-screen" class="screen">
  <div class="topbar">
    <div class="topbar-l">
      <div class="wordmark"><span>✦</span> SJ PROXY</div>
      <div class="tdiv"></div>
      <div class="user-chip">
        <span class="chip-dot" id="chip-dot"></span>
        <span id="user-label"></span>
      </div>
    </div>
    <div class="topbar-r">
      <button class="cart-btn" id="cart-btn" onclick="toggleCart()" style="display:none">
        🛒 購物車
        <span class="cart-badge hidden" id="cart-badge">0</span>
      </button>
      <button class="logout-btn" onclick="logout()">登出</button>
    </div>
  </div>

  <div class="tabs">
    <button class="tab active" data-tab="events" onclick="switchTab('events')">活動場次</button>
    <button class="tab" data-tab="admin" id="tab-admin-btn" style="display:none" onclick="switchTab('admin')">⚙ 管理後台</button>
    <button class="tab" data-tab="orders" id="tab-orders-btn" style="display:none" onclick="switchTab('orders')">📋 訂單記錄</button>
  </div>

  <div class="main">
    <!-- Events pane -->
    <div id="pane-events">
      <div id="view-list">
        <div class="events-grid" id="events-grid">
          <div class="empty-state"><span class="ico">📭</span><p>目前沒有活動場次</p></div>
        </div>
      </div>
      <div id="view-products" style="display:none">
        <button class="back-btn" onclick="backToList()">← 返回活動列表</button>
        <div class="pv-header">
          <div>
            <div class="pv-title" id="pv-title"></div>
            <div id="pv-tags" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:6px"></div>
          </div>
          <div id="pv-fx" class="fx-chip" style="display:none"></div>
        </div>
        <div id="pv-thresh" class="threshold-bar" style="display:none">
          🎁 本活動消費滿 <b id="pv-thresh-val" style="font-family:'DM Mono';margin:0 4px"></b> <span id="pv-thresh-cur">TWD</span> 可獲得滿額卡
        </div>
        <div class="ptable-wrap">
          <table class="ptable">
            <thead>
              <tr><th>品名</th><th>備注</th><th>售價</th><th>數量／選項</th></tr>
            </thead>
            <tbody id="prod-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Admin pane -->
    <div id="pane-admin" style="display:none">
      <div class="admin-card">
        <div class="card-title">✦ 新增活動場次</div>
        <div class="fgrid">
          <div class="fg"><label class="fl">活動名稱</label><input class="fi" id="a-name" placeholder="例：SUPER JUNIOR WORLD TOUR 周邊"></div>
          <div class="fg"><label class="fl">活動日期</label><input class="fi" type="date" id="a-date"></div>
        </div>
        <div class="fgrid g3">
          <div class="fg">
            <label class="fl">商品幣別</label>
            <select class="fsel" id="a-currency" onchange="updateRateHelp()">
              <option value="TWD">TWD — 新台幣</option>
              <option value="KRW">KRW — 韓元</option>
              <option value="JPY">JPY — 日元</option>
              <option value="USD">USD — 美元</option>
              <option value="CNY">CNY — 人民幣</option>
              <option value="HKD">HKD — 港幣</option>
              <option value="EUR">EUR — 歐元</option>
            </select>
          </div>
          <div class="fg" id="rate-grp">
            <label class="fl">匯率 1 <span id="rate-cur-label" style="color:var(--sky)"></span> = ? TWD</label>
            <input class="fi" type="number" id="a-rate" placeholder="例：0.023" step="0.0001" min="0.0001" value="1">
          </div>
          <div class="fg">
            <label class="fl">滿額卡門檻 <span id="threshold-cur-label">TWD</span>（0=不設）</label>
            <input class="fi" type="number" id="a-threshold" placeholder="0" min="0">
          </div>
        </div>
        <div class="fgrid">
          <div class="fg"><label class="fl">活動說明（選填）</label><input class="fi" id="a-desc" placeholder="補充資訊"></div>
          <div class="fg"><label class="fl">下單期限（選填）</label><input class="fi" type="datetime-local" id="a-deadline"></div>
          <div class="fg" style="visibility:hidden"><label class="fl">佔位</label><input class="fi" disabled></div>
        </div>
        <div class="fl" style="margin-bottom:10px">商品列表</div>
        <div class="prow-wrap">
          <div class="prow-head">
            <span>品名</span><span>售價（原幣）</span><span>備注</span><span>選項類型</span><span>自訂選項值</span><span></span>
          </div>
          <div id="prod-list"></div>
        </div>
        <button class="add-row-btn" onclick="addProdRow()">＋ 新增商品</button>
        <br><br>
        <button class="save-btn" onclick="saveEvent()">儲存活動</button>
      </div>
      <div class="admin-card">
        <div class="card-title">📋 管理活動</div>
        <div id="admin-ev-list"><div class="empty-state" style="padding:30px 0"><p>目前沒有活動</p></div></div>
      </div>
    </div>

    <!-- Orders pane -->
    <div id="pane-orders" style="display:none">
      <div id="orders-wrap"><div class="empty-state"><span class="ico">📋</span><p>目前沒有訂單記錄</p></div></div>
    </div>
  </div>
</div>

<!-- CART -->
<div class="cart-ov" id="cart-ov" onclick="ovClick(event)">
  <div class="cart-panel">
    <div class="cart-head">
      <h3>🛒 購物車</h3>
      <div style="display:flex;gap:8px">
        <button class="close-btn" onclick="shareCart()" title="分享清單" style="width:auto;padding:0 10px;font-size:13px;color:var(--sky-lt);border-color:var(--border2)">分享</button>
        <button class="close-btn" onclick="toggleCart()">✕</button>
      </div>
    </div>
    <div class="cart-items-list" id="cart-items-list"></div>
    <div class="cart-foot">
      <div id="cart-sum"></div>
      <textarea class="remark-inp" id="cart-remark" placeholder="備注（選填）"></textarea>
      <button class="btn-primary" id="submit-btn" onclick="submitOrder()">確認送出訂單</button>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal-ov" id="modal">
  <div class="modal-box">
    <h3 id="modal-title"></h3>
    <p id="modal-msg"></p>
    <div class="modal-btns">
      <button class="btn-ghost" onclick="closeModal()">取消</button>
      <button class="btn-primary" style="width:auto;padding:9px 22px" id="modal-ok">確認</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script src="app.js"></script>
</body>
</html>
